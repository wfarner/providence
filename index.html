<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.7.1 at 2017-02-02 
 | Rendered using Apache Maven Fluido Skin 1.6
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20170202" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Providence &#x2013; Providence Serialization</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.6.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
      <script type="text/javascript" src="./js/apache-maven-fluido-1.6.min.js"></script>
      </head>
    <body class="topBarDisabled">
                      <a href="https://github.com/morimekta/providence">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"
        alt="Fork me on GitHub">
    </a>
      <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><div id="bannerLeft"><h2>Providence</h2>
</div>
</div>
        <div class="pull-right"></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2017-02-02<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 0.3.8</li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
<ul class="nav nav-list">
          <li class="nav-header">Project Documentation</li>
    <li><a href="project-info.html" title="Project Information"><span class="icon-chevron-down"></span>Project Information</a>
      <ul class="nav nav-list">
    <li class="active"><a href="#"><span class="none"></span>About</a>
  </li>
    <li><a href="license.html" title="Licenses"><span class="none"></span>Licenses</a>  </li>
    <li><a href="team-list.html" title="Team"><span class="none"></span>Team</a>  </li>
      </ul>
  </li>
          <li class="nav-header">Introduction</li>
    <li class="active"><a href="#"><span class="none"></span>Providence</a>
  </li>
    <li><a href="providence-tools.html" title="Providence Tools"><span class="none"></span>Providence Tools</a>  </li>
    <li><a href="https://github.com/morimekta/providence/releases" class="externalLink" title="Downloads & Releases"><span class="none"></span>Downloads & Releases</a>  </li>
          <li class="nav-header">Modules</li>
    <li><a href="providence-core/index.html" title="Core"><span class="none"></span>Core</a>  </li>
    <li><a href="providence-core-client/index.html" title="Core : Client"><span class="none"></span>Core : Client</a>  </li>
    <li><a href="providence-core-server/index.html" title="Core : Server"><span class="none"></span>Core : Server</a>  </li>
    <li><a href="providence-reflect/index.html" title="Utils : Reflect"><span class="none"></span>Utils : Reflect</a>  </li>
    <li><a href="providence-thrift/index.html" title="Utils : Thrift Bridge"><span class="none"></span>Utils : Thrift Bridge</a>  </li>
    <li><a href="providence-testing/index.html" title="Utils : Testing"><span class="none"></span>Utils : Testing</a>  </li>
    <li><a href="providence-config/index.html" title="Utils : Config"><span class="none"></span>Utils : Config</a>  </li>
    <li><a href="providence-jax-rs/index.html" title="Utils : Javax-Ws-Rs"><span class="none"></span>Utils : Javax-Ws-Rs</a>  </li>
    <li><a href="providence-generator/index.html" title="Tools : Generator"><span class="none"></span>Tools : Generator</a>  </li>
    <li><a href="providence-generator-java/index.html" title="Tools : Generator - Java"><span class="none"></span>Tools : Generator - Java</a>  </li>
    <li><a href="providence-generator-json/index.html" title="Tools : Generator - JSON"><span class="none"></span>Tools : Generator - JSON</a>  </li>
    <li><a href="providence-maven-plugin/index.html" title="Tools : Maven Plugin"><span class="none"></span>Tools : Maven Plugin</a>  </li>
    <li><a href="providence-gradle-plugin.html" title="Tools : Gradle Plugin"><span class="none"></span>Tools : Gradle Plugin</a>  </li>
          <li class="nav-header">Generator Options</li>
    <li><a href="options.html" title="Options Overview"><span class="none"></span>Options Overview</a>  </li>
    <li><a href="options-hazelcast.html" title="Hazelcast Portable"><span class="none"></span>Hazelcast Portable</a>  </li>
    <li><a href="options-android.html" title="Android Parcelable"><span class="none"></span>Android Parcelable</a>  </li>
    <li><a href="options-jackson.html" title="Jackson Annotations"><span class="none"></span>Jackson Annotations</a>  </li>
          <li class="nav-header">Documentation</li>
    <li><a href="release.html" title="Release Process"><span class="none"></span>Release Process</a>  </li>
    <li><a href="integration-testing.html" title="Integration Testing"><span class="none"></span>Integration Testing</a>  </li>
    <li><a href="serializer-binary.html" title="Serializer : Binary"><span class="none"></span>Serializer : Binary</a>  </li>
    <li><a href="serializer-fast-binary.html" title="Serializer : Fast Binary"><span class="none"></span>Serializer : Fast Binary</a>  </li>
    <li><a href="serializer-json.html" title="Serializer : JSON"><span class="none"></span>Serializer : JSON</a>  </li>
  </ul>
          <hr />
          <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
  <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
              </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span10" >
<h1>Providence Serialization</h1>
<p>The <tt>providence</tt> project was made in order to make an immutable model java library for thrift. It is mostly separate from the thrift library, but can use the standard thrift protocols to serialize and serialize messages. It is mainly based on the Facebook / Apache <a class="externalLink" href="https://thrift.apache.org/">thrift</a> library, but with some differences and limitations.</p>
<div class="section">
<h2><a name="Setup"></a>Setup</h2>
<p>In order to compile providence, you need <tt>java</tt> and <tt>javac</tt> (I recommend <tt>openjdk8-jdk</tt>), and <tt>maven</tt> (3.3). Check out <tt>git@github.com:morimekta/providence.git</tt> and build with <tt>mvn clean verify install</tt>.</p></div>
<div class="section">
<h2><a name="Differences_with_Thrift"></a>Differences with Thrift</h2>
<p>providence is not <i>exactly</i> like thrift. The differences are mostly minute, but all feature changes are there for a reason. Differences are based on the IDL at <a class="externalLink" href="https://thrift.apache.org/docs/idl">thrift.apache.org</a>.</p>
<div class="section">
<h3><a name="Alterations_to_thrift_IDL"></a>Alterations to thrift IDL</h3>
<p>Constant data syntax has to follow JSON syntax. So &#x2018;,&#x2019; are mandatory in list item separation, &#x2019;&#x201c;&#x2019; is only string literal char. Exception is that map keys can be the actual value. Enum values cannot be used as a generic &#x201d;number&quot; reference in constants, only to set the enum value itself.</p>
<p>Fields with conflicting but differing names are explicitly disallowed. E.g. &#x201c;my_field&#x201d; and &#x201c;myField&#x201d; are considered conflicting because they would generate the same names when c_casing or camelCasing the name.</p></div>
<div class="section">
<h3><a name="Added_support"></a>Added support</h3>
<p>There are also extra features added that the original Apache Thrift format does not support, or is only supported on very limited cases.</p>
<div class="section">
<h4><a name="Annotations"></a>Annotations</h4>
<p>Annotations are actually supported by the thrift compiler, but is not defined in the IDL. Annotations follow the syntax of:</p>

<div class="source">
<div class="source"><pre class="prettyprint">ANNOTATIONS :== '(' ANNOTATION [[,;] ANNOTATION]* ')'

ANNOTATION  :== IDENTIFIER '=' LITERAL
</pre></div></div>
<p>Which is put <i>after</i> the actual definition, but <i>before</i> any list separator. The annotation key can be <i>any</i> legal identifier, and the value can be any string literal. E.g.:</p>

<div class="source">
<div class="source"><pre class="prettyprint">struct MyStruct {
  1: i32 something
  (something.anno = &quot;value&quot;)
  2: i32 field (field.anno = &quot;value&quot;);
} (struct.anno = &quot;value&quot;)
</pre></div></div>
<p>Annotations are there for the compiler only, and should not be saved in the generated code. Currently the recognized annotations are:</p>

<ul>
  
<li><tt>compact = &quot;&quot;</tt>: On structs only, see the (Compact Messages)[#compact-messages] section.</li>
  
<li><tt>container = &quot;ORDERED&quot;</tt>: On fields with set or map type only, will replace the  default hash-based container with an order-preserving container.</li>
  
<li><tt>container = &quot;SORTED&quot;</tt>: On fields with set or map type only, will replace the  default hash-based container with a sorted container.</li>
  
<li><tt>java.implements</tt> Each java message (union, struct, exception) can implement  additional interfaces specified by this annotation. Full package and class name.  Note that the message is still a full implementation, so the interface methods  need to be implemented (declared) by the generated code, or have default  implementation.</li>
  
<li><tt>java.exception.class</tt> Which exception class to inherit from. This must be the  full class path of an exception. Note that whether it is an exception is not  checked in the generator, it is plainly trusted as the exception class.</li>
  
<li>
<p><tt>java.service.methods.throws</tt> Which replaces the declared exceptions with the  given exception class on the <b>service interface only</b>. Also note that:</p>
  
<ul>
    
<li>The property is <b>not</b> inherited, and only applies to the methods declared on  the service with the annotation.</li>
    
<li>All the declared exceptions <b>must</b> extend the given exception.</li>
    
<li>The exception class <b>must</b> be available at compile time, and have a  constructor that takes the message string only.</li>
    
<li>Any exception that not declared, including those that extend the base exception  class will be handled as an application level failure, throwing  <tt>PApplicationException</tt>.</li>
    
<li>The client will still only throw the declared exceptions (and <tt>IOException</tt>).</li>
  </ul></li>
</ul></div>
<div class="section">
<h4><a name="Circular_containment"></a>Circular containment</h4>
<p>Circular containment is explicitly supported as long as the entire circle is contained within the same thrift definition file. E.g.:</p>

<ul>
  
<li>struct A contains struct B contains struct A.</li>
</ul>

<div class="source">
<div class="source"><pre class="prettyprint">namespace java net.morimekta.test.calculator

enum Operator {
    IDENTITY = 1,
    ADD,
    SUBTRACT,
    MULTIPLY,
    DIVIDE
}

union Operand {
    1: Operation operation;
    2: double number;
}

struct Operation {
    1: Operator operator;
    2: list&lt;Operand&gt; operands;
}
</pre></div></div>
<p>This makes model structures like the calculator possible. Since the model objects are immutable and created with builders, it is not possible to create a circular instance containment.</p></div>
<div class="section">
<h4><a name="Compact_Messages"></a>Compact Messages</h4>
<p>A struct may be defined as <tt>compact</tt>. A compact struct must adhere to the compact criteria:</p>

<ul>
  
<li>Only structs may be compact (not union or exception).</li>
  
<li>May have a maximum of 10 fields.</li>
  
<li>Fields must be numbered 1 .. N.</li>
  
<li>A required field may not come after an optional field.</li>
  
<li>For the &#x2018;compact&#x2019; serialization to take effect, the first M fields must be set,  and no other fields may be set. E.g.:
  
<ul>
    
<li>If 1, 2 abd 3 are set, and 4, 5 are not set, then compact is used.</li>
    
<li>If 1, 2 and 4 are set, and 3, 5 are not set, compact is <b>not</b> used.</li>
  </ul></li>
</ul>
<p>When the compact struct is serialized the serializer may choose to use a different serialization format that serializes the first M fields of the struct in order. E.g. in JSON a compact struct may be serialized as an array if (and only if).</p>
<p>Messages will have a <tt>compact()</tt> method that determines if the message is compact compatible for serialization. Descriptors will have a similar <tt>isCompactible()</tt> method which determines if the message can be deserialized with the compact format.</p>
<p>To make a struct compact, add the <tt>compact = &quot;&quot;</tt> annotation to the struct. This will still allow thrift compiler to parse the .thrift files.</p></div>
<div class="section">
<h4><a name="Simple_Messages."></a>Simple Messages.</h4>
<p>A simple message is one that does not contain nested structures, e.g. no containers, and no internal messages. Simple messages are easier to use as map keys, and some serialization formats may require that map key messages to be simple. Note that the simple definition is on the type, not the message.</p></div>
<div class="section">
<h4><a name="Reserved_words."></a>Reserved words.</h4>
<p>Each format should make getters, setters and mutators, field names etc that are compatible with the language using prefixes, suffixes and name modifications. E.g. the field name &#x2018;public&#x2019; should be allowed for all languages, oncluding java and C++ where it is a reserved word.</p>
<p>In Java:</p>

<ul>
  
<li>field names are prefixed with <tt>m</tt> and camel cased. E.g. <tt>my_field</tt> becomes  <tt>mMyField</tt>.</li>
  
<li>getters and setters are prefixed with <tt>set</tt>, <tt>addTo</tt>, <tt>get</tt>, <tt>clear</tt>,  <tt>mutable</tt>, <tt>has</tt> and <tt>num</tt>. respectively.</li>
</ul>
<p>Or in C++ or python. All the names are initially lowercase c_cased before included in the code.</p>

<ul>
  
<li><b>C++</b>: field names are suffixed with <tt>_</tt>. E.g. <tt>myField</tt> becomes <tt>my_field_</tt>.</li>
  
<li><b>python</b>: field names are prefixed with <tt>__</tt>. E.g. <tt>myField</tt> becomes <tt>__my_field</tt>.</li>
  
<li>getters and setters are prefixed with <tt>set_</tt>, <tt>get_</tt>, <tt>mutable_</tt>, <tt>clear_</tt> <tt>add_to_</tt>, <tt>has_</tt> and <tt>num_</tt>.</li>
  
<li>This breaks the somewhat spread convention that C++ getters should not have any prefix or suffix, but  it makes it possible to use otherwise reserved words as field names.</li>
</ul></div></div>
<div class="section">
<h3><a name="Removed_support"></a>Removed support</h3>
<p><tt>*_namespace</tt> keywords are not supported. Use <tt>namespace php [package]</tt> instead for php. None of the facebook specific modifiers are supported. They are also removed from keyword lists (xsd_nullable, xsd_optional and the xsd namespace), but annotations should be able to fill that gap.</p></div></div>
<div class="section">
<h2><a name="Contributing"></a>Contributing</h2>
<p>You can send me an <a class="externalLink" href="mailto:oss@morimekta.net">email</a> to suggest a feature. Or you can make it yourself by cloning <a class="externalLink" href="https://github.com/morimekta/providence">the project</a>, and create a <a class="externalLink" href="https://github.com/morimekta/providence/pulls">pull request</a> for your change.</p>
<p>Make sure to name it properly, and describe what the change does, and assign the request to <a class="externalLink" href="https://github.com/morimekta">@morimekta</a>. That should send me an email, so I know it&#x2019;s there and take care of it.</p></div>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
<script>
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

                ga('create', 'UA-3087264-4', 'auto');
                ga('send', 'pageview');
            </script>
        </div>
        </div>
    </footer>
    </body>
</html>
