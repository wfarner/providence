<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>CommonOverridesFormatter.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Providence Generator : Java</a> &gt; <a href="index.source.html" class="el_package">net.morimekta.providence.generator.format.java.messages</a> &gt; <span class="el_source">CommonOverridesFormatter.java</span></div><h1>CommonOverridesFormatter.java</h1><pre class="source lang-java linenums">/*
 * Copyright 2016 Providence Authors
 *
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements. See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership. The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * &quot;License&quot;); you may not use this file except in compliance
 * with the License. You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied. See the License for the
 * specific language governing permissions and limitations
 * under the License.
 */
package net.morimekta.providence.generator.format.java.messages;

import net.morimekta.providence.generator.GeneratorException;
import net.morimekta.providence.generator.format.java.shared.MessageMemberFormatter;
import net.morimekta.providence.generator.format.java.utils.JAnnotation;
import net.morimekta.providence.generator.format.java.utils.JField;
import net.morimekta.providence.generator.format.java.utils.JMessage;
import net.morimekta.util.Strings;
import net.morimekta.util.io.IndentedPrintWriter;

import java.io.Serializable;
import java.util.Arrays;
import java.util.Collection;
import java.util.LinkedList;
import java.util.List;
import java.util.Objects;

import static com.google.common.base.Strings.isNullOrEmpty;
import static net.morimekta.providence.generator.format.java.messages.CoreOverridesFormatter.UNION_FIELD;

/**
 * @author Stein Eldar Johnsen
 * @since 08.01.16.
 */
public class CommonOverridesFormatter implements MessageMemberFormatter {
    protected final IndentedPrintWriter writer;

<span class="fc" id="L48">    public CommonOverridesFormatter(IndentedPrintWriter writer) {</span>
<span class="fc" id="L49">        this.writer = writer;</span>
<span class="fc" id="L50">    }</span>

    @Override
    public Collection&lt;String&gt; getExtraImplements(JMessage&lt;?&gt; message) throws GeneratorException {
<span class="fc" id="L54">        LinkedList&lt;String&gt; impl = new LinkedList&lt;&gt;();</span>

<span class="fc" id="L56">        impl.add(Comparable.class.getSimpleName() + &quot;&lt;&quot; + message.instanceType() + &quot;&gt;&quot;);</span>
<span class="fc bfc" id="L57" title="All 2 branches covered.">        if (!message.isException()) {</span>
<span class="fc" id="L58">            impl.add(Serializable.class.getName());</span>
        }

<span class="pc bpc" id="L61" title="1 of 2 branches missed.">        if (!isNullOrEmpty(message.extraImplements())) {</span>
<span class="nc" id="L62">            String[] extras = message.extraImplements().split(&quot;[,]&quot;);</span>
            // TODO: Figure out if we need to have a filter here.
<span class="nc" id="L64">            Arrays.stream(extras)</span>
<span class="nc" id="L65">                  .map(String::trim)</span>
<span class="nc" id="L66">                  .forEachOrdered(impl::add);</span>
        }

<span class="fc" id="L69">        return impl;</span>
    }

    private String caseFieldConstant(JField field) {
<span class="fc" id="L73">        return field.fieldEnum();</span>
    }

    @Override
    public void appendFields(JMessage&lt;?&gt; message) throws GeneratorException {
<span class="fc" id="L78">        writer.appendln(&quot;private volatile int tHashCode;&quot;)</span>
<span class="fc" id="L79">              .newline();</span>
<span class="fc" id="L80">    }</span>

    @Override
    public void appendMethods(JMessage message) {
        // Object
<span class="fc" id="L85">        appendEquals(message);</span>
<span class="fc" id="L86">        appendHashCode(message);</span>
<span class="fc" id="L87">        appendToString(message);</span>
        // Stringable
<span class="fc" id="L89">        appendAsString(message);</span>
        // Comparable
<span class="fc" id="L91">        appendCompareTo(message);</span>
<span class="fc" id="L92">    }</span>

    private void appendEquals(JMessage&lt;?&gt; message) {
<span class="fc" id="L95">        writer.appendln(&quot;@Override&quot;)</span>
<span class="fc" id="L96">              .appendln(&quot;public boolean equals(Object o) {&quot;)</span>
<span class="fc" id="L97">              .begin()</span>
<span class="fc" id="L98">              .appendln(&quot;if (o == this) return true;&quot;)</span>
<span class="fc" id="L99">              .appendln(&quot;if (o == null || !o.getClass().equals(getClass())) return false;&quot;);</span>
<span class="fc" id="L100">        if (message.numericalOrderFields()</span>
<span class="fc bfc" id="L101" title="All 2 branches covered.">                   .size() &gt; 0) {</span>
<span class="fc" id="L102">            boolean first = true;</span>
<span class="fc" id="L103">            writer.formatln(&quot;%s other = (%s) o;&quot;, message.instanceType(), message.instanceType())</span>
<span class="fc" id="L104">                  .appendln(&quot;return &quot;);</span>
<span class="fc bfc" id="L105" title="All 2 branches covered.">            if (message.isUnion()) {</span>
<span class="fc" id="L106">                writer.format(&quot;%s.equals(%s, other.%s)&quot;,</span>
<span class="fc" id="L107">                              Objects.class.getName(),</span>
                              UNION_FIELD,
                              UNION_FIELD);
<span class="fc" id="L110">                first = false;</span>
            }
<span class="fc bfc" id="L112" title="All 2 branches covered.">            for (JField field : message.declaredOrderFields()) {</span>
<span class="fc bfc" id="L113" title="All 2 branches covered.">                if (field.isVoid()) continue;</span>

<span class="fc bfc" id="L115" title="All 2 branches covered.">                if (first) {</span>
<span class="fc" id="L116">                    first = false;</span>
                } else {
<span class="fc" id="L118">                    writer.append(&quot; &amp;&amp;&quot;)</span>
<span class="fc" id="L119">                          .appendln(&quot;       &quot;);</span>
                }
<span class="fc" id="L121">                writer.format(&quot;%s.equals(%s, other.%s)&quot;,</span>
<span class="fc" id="L122">                              Objects.class.getName(),</span>
<span class="fc" id="L123">                              field.member(), field.member());</span>
<span class="fc" id="L124">            }</span>
<span class="fc" id="L125">            writer.append(';');</span>
<span class="fc" id="L126">        } else {</span>
<span class="fc" id="L127">            writer.appendln(&quot;return true;&quot;);</span>
        }
<span class="fc" id="L129">        writer.end()</span>
<span class="fc" id="L130">              .appendln(&quot;}&quot;)</span>
<span class="fc" id="L131">              .newline();</span>
<span class="fc" id="L132">    }</span>

    private void appendHashCode(JMessage&lt;?&gt; message) {
<span class="fc" id="L135">        writer.appendln(&quot;@Override&quot;)</span>
<span class="fc" id="L136">              .appendln(&quot;public int hashCode() {&quot;)</span>
<span class="fc" id="L137">              .begin()</span>
<span class="fc" id="L138">              .appendln(&quot;if (tHashCode == 0) {&quot;)</span>
<span class="fc" id="L139">              .begin()</span>
<span class="fc" id="L140">              .formatln(&quot;tHashCode = %s.hash(&quot;,</span>
<span class="fc" id="L141">                        Objects.class.getName())</span>
<span class="fc" id="L142">              .begin(&quot;        &quot;)</span>
<span class="fc" id="L143">              .formatln(&quot;%s.class&quot;, message.instanceType());</span>
<span class="fc" id="L144">        message.numericalOrderFields()</span>
<span class="fc" id="L145">               .stream()</span>
<span class="fc bfc" id="L146" title="All 2 branches covered.">               .filter(field -&gt; !field.isVoid())</span>
<span class="fc" id="L147">               .forEach(field -&gt; {</span>
<span class="fc" id="L148">                   writer.append(&quot;,&quot;);</span>
<span class="fc" id="L149">                   writer.formatln(&quot;_Field.%s, %s&quot;, field.fieldEnum(), field.member());</span>
<span class="fc" id="L150">               });</span>

<span class="fc" id="L152">        writer.end()</span>
<span class="fc" id="L153">              .append(&quot;);&quot;)</span>
<span class="fc" id="L154">              .end()</span>
<span class="fc" id="L155">              .appendln('}')</span>
<span class="fc" id="L156">              .appendln(&quot;return tHashCode;&quot;)</span>
<span class="fc" id="L157">              .end()</span>
<span class="fc" id="L158">              .appendln(&quot;}&quot;)</span>
<span class="fc" id="L159">              .newline();</span>
<span class="fc" id="L160">    }</span>

    private void appendToString(JMessage&lt;?&gt; message) {
<span class="fc" id="L163">        writer.appendln(&quot;@Override&quot;)</span>
<span class="fc" id="L164">              .appendln(&quot;public String toString() {&quot;)</span>
<span class="fc" id="L165">              .begin()</span>
<span class="fc" id="L166">              .formatln(&quot;return \&quot;%s\&quot; + asString();&quot;,</span>
<span class="fc" id="L167">                        message.descriptor()</span>
<span class="fc" id="L168">                               .getQualifiedName())</span>
<span class="fc" id="L169">              .end()</span>
<span class="fc" id="L170">              .appendln('}')</span>
<span class="fc" id="L171">              .newline();</span>
<span class="fc" id="L172">    }</span>

    private void appendAsString(JMessage&lt;?&gt; message) {
<span class="fc" id="L175">        writer.appendln(&quot;@Override&quot;)</span>
<span class="fc" id="L176">              .appendln(JAnnotation.NON_NULL)</span>
<span class="fc" id="L177">              .appendln(&quot;public String asString() {&quot;)</span>
<span class="fc" id="L178">              .begin()</span>
<span class="fc" id="L179">              .appendln(&quot;StringBuilder out = new StringBuilder();&quot;)</span>
<span class="fc" id="L180">              .appendln(&quot;out.append(\&quot;{\&quot;);&quot;)</span>
<span class="fc" id="L181">              .newline();</span>

<span class="fc bfc" id="L183" title="All 2 branches covered.">        if (message.isUnion()) {</span>
<span class="fc" id="L184">            writer.formatln(&quot;switch (%s) {&quot;, UNION_FIELD)</span>
<span class="fc" id="L185">                  .begin();</span>

<span class="fc bfc" id="L187" title="All 2 branches covered.">            for (JField field : message.declaredOrderFields()) {</span>
<span class="fc" id="L188">                writer.formatln(&quot;case %s: {&quot;, caseFieldConstant(field))</span>
<span class="fc" id="L189">                      .begin()</span>
<span class="fc" id="L190">                      .formatln(&quot;out.append(\&quot;%s:\&quot;)&quot;, field.name());</span>

<span class="pc bpc" id="L192" title="1 of 8 branches missed.">                switch (field.type()) {</span>
                    case VOID:
<span class="fc" id="L194">                        writer.formatln(&quot;   .append(\&quot;true\&quot;);&quot;);</span>
<span class="fc" id="L195">                        break;</span>
                    case BOOL:
                    case I32:
                    case I64:
<span class="fc" id="L199">                        writer.formatln(&quot;   .append(%s);&quot;, field.member());</span>
<span class="fc" id="L200">                        break;</span>
                    case BYTE:
                    case I16:
<span class="fc" id="L203">                        writer.formatln(&quot;   .append((int) %s);&quot;, field.member());</span>
<span class="fc" id="L204">                        break;</span>
                    case DOUBLE:
                    case SET:
                    case LIST:
                    case MAP:
<span class="fc" id="L209">                        writer.formatln(&quot;   .append(%s.asString(%s));&quot;,</span>
<span class="fc" id="L210">                                        Strings.class.getName(),</span>
<span class="fc" id="L211">                                        field.member());</span>
<span class="fc" id="L212">                        break;</span>
                    case STRING:
<span class="fc" id="L214">                        writer.formatln(&quot;   .append('\\\&quot;').append(%s.escape(%s)).append('\\\&quot;');&quot;,</span>
<span class="fc" id="L215">                                        Strings.class.getName(),</span>
<span class="fc" id="L216">                                        field.member());</span>
<span class="fc" id="L217">                        break;</span>
                    case BINARY:
<span class="fc" id="L219">                        writer.formatln(&quot;   .append(\&quot;b64(\&quot;).append(%s.toBase64()).append(')');&quot;, field.member());</span>
<span class="fc" id="L220">                        break;</span>
                    case MESSAGE:
                    case ENUM:
<span class="fc" id="L223">                        writer.formatln(&quot;   .append(%s.asString());&quot;, field.member());</span>
<span class="fc" id="L224">                        break;</span>
                    default:
<span class="nc" id="L226">                        writer.formatln(&quot;   .append(%s.toString());&quot;, field.member());</span>
                        break;
                }

<span class="fc" id="L230">                writer.appendln(&quot;break;&quot;)</span>
<span class="fc" id="L231">                      .end()</span>
<span class="fc" id="L232">                      .appendln('}');</span>
<span class="fc" id="L233">            }</span>
<span class="fc" id="L234">            writer.end()</span>
<span class="fc" id="L235">                  .appendln('}');</span>
        } else {
<span class="fc" id="L237">            boolean hasFirstFlag = false;</span>
<span class="fc" id="L238">            boolean allowSeparator = false;</span>
<span class="fc" id="L239">            boolean requireSeparator = false;</span>

<span class="fc" id="L241">            List&lt;JField&gt; fieldList = message.declaredOrderFields();</span>

<span class="fc" id="L243">            JField[] fields = fieldList.toArray(new JField[fieldList.size()]);</span>
<span class="fc bfc" id="L244" title="All 2 branches covered.">            for (int i = 0; i &lt; fields.length; ++i) {</span>
<span class="fc" id="L245">                JField field = fields[i];</span>

<span class="fc bfc" id="L247" title="All 2 branches covered.">                boolean last = (i == (fields.length - 1));</span>
<span class="fc bfc" id="L248" title="All 2 branches covered.">                if (!field.alwaysPresent()) {</span>
<span class="fc bfc" id="L249" title="All 6 branches covered.">                    if (!last &amp;&amp; !requireSeparator &amp;&amp; !hasFirstFlag) {</span>
<span class="fc" id="L250">                        writer.appendln(&quot;boolean first = true;&quot;);</span>
<span class="fc" id="L251">                        hasFirstFlag = true;</span>
                    }
<span class="fc" id="L253">                    writer.formatln(&quot;if (%s()) {&quot;, field.presence());</span>
<span class="fc" id="L254">                    writer.begin();</span>
                }

<span class="fc bfc" id="L257" title="All 2 branches covered.">                if (requireSeparator) {</span>
<span class="fc" id="L258">                    writer.appendln(&quot;out.append(',');&quot;);</span>
                } else {
<span class="fc bfc" id="L260" title="All 2 branches covered.">                    if (allowSeparator) {</span>
<span class="pc bpc" id="L261" title="1 of 2 branches missed.">                        if (hasFirstFlag) {</span>
<span class="pc bpc" id="L262" title="1 of 4 branches missed.">                            if (last || field.alwaysPresent()) {</span>
<span class="fc" id="L263">                                writer.appendln(&quot;if (!first) out.append(',');&quot;);</span>
                            } else {
<span class="fc" id="L265">                                writer.appendln(&quot;if (first) first = false;&quot;)</span>
<span class="fc" id="L266">                                      .appendln(&quot;else out.append(',');&quot;);</span>
                            }
                        }
<span class="fc bfc" id="L269" title="All 2 branches covered.">                    } else if (hasFirstFlag) {</span>
<span class="fc" id="L270">                        writer.appendln(&quot;first = false;&quot;);</span>
                    }
                }

<span class="fc" id="L274">                writer.formatln(&quot;out.append(\&quot;%s:\&quot;)&quot;, field.name());</span>
<span class="pc bpc" id="L275" title="1 of 7 branches missed.">                switch (field.type()) {</span>
                    case BOOL:
                    case I32:
                    case I64:
<span class="fc" id="L279">                        writer.formatln(&quot;   .append(%s);&quot;, field.member());</span>
<span class="fc" id="L280">                        break;</span>
                    case BYTE:
                    case I16:
<span class="fc" id="L283">                        writer.formatln(&quot;   .append((int) %s);&quot;, field.member());</span>
<span class="fc" id="L284">                        break;</span>
                    case DOUBLE:
                    case MAP:
                    case SET:
                    case LIST:
<span class="fc" id="L289">                        writer.formatln(&quot;   .append(%s.asString(%s));&quot;,</span>
<span class="fc" id="L290">                                        Strings.class.getName(),</span>
<span class="fc" id="L291">                                        field.member());</span>
<span class="fc" id="L292">                        break;</span>
                    case STRING:
<span class="fc" id="L294">                        writer.appendln(&quot;   .append('\\\&quot;')&quot;)</span>
<span class="fc" id="L295">                              .formatln(&quot;   .append(%s.escape(%s))&quot;,</span>
<span class="fc" id="L296">                                        Strings.class.getName(),</span>
<span class="fc" id="L297">                                        field.member())</span>
<span class="fc" id="L298">                              .appendln(&quot;   .append('\\\&quot;');&quot;);</span>
<span class="fc" id="L299">                        break;</span>
                    case BINARY:
<span class="fc" id="L301">                        writer.appendln(&quot;   .append(\&quot;b64(\&quot;)&quot;)</span>
<span class="fc" id="L302">                              .formatln(&quot;   .append(%s.toBase64())&quot;, field.member())</span>
<span class="fc" id="L303">                              .appendln(&quot;   .append(')');&quot;);</span>
<span class="fc" id="L304">                        break;</span>
                    case MESSAGE:
                    case ENUM:
<span class="fc" id="L307">                        writer.formatln(&quot;   .append(%s.asString());&quot;, field.member());</span>
<span class="fc" id="L308">                        break;</span>
                    default:
<span class="nc" id="L310">                        writer.formatln(&quot;   .append(%s.toString());&quot;, field.member());</span>
                        break;
                }

<span class="fc bfc" id="L314" title="All 2 branches covered.">                if (field.alwaysPresent()) {</span>
<span class="fc" id="L315">                    requireSeparator = true;</span>
                } else {
<span class="fc" id="L317">                    writer.end()</span>
<span class="fc" id="L318">                          .appendln('}');</span>
<span class="fc" id="L319">                    allowSeparator = true;</span>
                }
            }
        }

<span class="fc" id="L324">        writer.appendln(&quot;out.append('}');&quot;)</span>
<span class="fc" id="L325">              .appendln(&quot;return out.toString();&quot;)</span>
<span class="fc" id="L326">              .end()</span>
<span class="fc" id="L327">              .appendln(&quot;}&quot;)</span>
<span class="fc" id="L328">              .newline();</span>
<span class="fc" id="L329">    }</span>

    private void appendCompareTo(JMessage&lt;?&gt; message) {
<span class="fc" id="L332">        writer.appendln(&quot;@Override&quot;)</span>
<span class="fc" id="L333">              .formatln(&quot;public int compareTo(%s other) {&quot;, message.instanceType())</span>
<span class="fc" id="L334">              .begin();</span>

<span class="fc bfc" id="L336" title="All 2 branches covered.">        if (message.isUnion()) {</span>
<span class="fc" id="L337">            writer.formatln(&quot;int c = %s.compareTo(other.%s);&quot;,</span>
                            UNION_FIELD, UNION_FIELD)
<span class="fc" id="L339">                  .appendln(&quot;if (c != 0) return c;&quot;)</span>
<span class="fc" id="L340">                  .newline()</span>
<span class="fc" id="L341">                  .formatln(&quot;switch (%s) {&quot;, UNION_FIELD)</span>
<span class="fc" id="L342">                  .begin();</span>

<span class="fc bfc" id="L344" title="All 2 branches covered.">            for (JField field : message.numericalOrderFields()) {</span>
<span class="fc" id="L345">                writer.formatln(&quot;case %s:&quot;, caseFieldConstant(field))</span>
<span class="fc" id="L346">                      .begin();</span>

<span class="fc bfc" id="L348" title="All 10 branches covered.">                switch (field.type()) {</span>
                    case BOOL:
<span class="fc" id="L350">                        writer.formatln(&quot;return Boolean.compare(%s, other.%s);&quot;, field.member(), field.member());</span>
<span class="fc" id="L351">                        break;</span>
                    case BYTE:
<span class="fc" id="L353">                        writer.formatln(&quot;return Byte.compare(%s, other.%s);&quot;, field.member(), field.member());</span>
<span class="fc" id="L354">                        break;</span>
                    case I16:
<span class="fc" id="L356">                        writer.formatln(&quot;return Short.compare(%s, other.%s);&quot;, field.member(), field.member());</span>
<span class="fc" id="L357">                        break;</span>
                    case I32:
<span class="fc" id="L359">                        writer.formatln(&quot;return Integer.compare(%s, other.%s);&quot;, field.member(), field.member());</span>
<span class="fc" id="L360">                        break;</span>
                    case I64:
<span class="fc" id="L362">                        writer.formatln(&quot;return Long.compare(%s, other.%s);&quot;, field.member(), field.member());</span>
<span class="fc" id="L363">                        break;</span>
                    case DOUBLE:
<span class="fc" id="L365">                        writer.formatln(&quot;return Double.compare(%s, other.%s);&quot;, field.member(), field.member());</span>
<span class="fc" id="L366">                        break;</span>
                    case STRING:
                    case BINARY:
                    case MESSAGE:
<span class="fc" id="L370">                        writer.formatln(&quot;return %s.compareTo(other.%s);&quot;, field.member(), field.member());</span>
<span class="fc" id="L371">                        break;</span>
                    case ENUM:
<span class="fc" id="L373">                        writer.formatln(&quot;return Integer.compare(%s.asInteger(), other.%s.asInteger());&quot;,</span>
<span class="fc" id="L374">                                        field.member(),</span>
<span class="fc" id="L375">                                        field.member());</span>
<span class="fc" id="L376">                        break;</span>
                    case SET:
                    case LIST:
                    case MAP:
                        // containers aren't really comparable, just make some consistent comparison.
<span class="fc" id="L381">                        writer.formatln(&quot;return Integer.compare(%s.hashCode(), other.%s.hashCode());&quot;,</span>
<span class="fc" id="L382">                                        field.member(),</span>
<span class="fc" id="L383">                                        field.member());</span>
<span class="fc" id="L384">                        break;</span>
                    default:
                        break;
                }

<span class="fc" id="L389">                writer.end();</span>
<span class="fc" id="L390">            }</span>
<span class="fc" id="L391">            writer.appendln(&quot;default: return 0;&quot;)</span>
<span class="fc" id="L392">                  .end()</span>
<span class="fc" id="L393">                  .appendln('}');</span>
        } else {
<span class="fc" id="L395">            writer.appendln(&quot;int c;&quot;);</span>

<span class="fc bfc" id="L397" title="All 2 branches covered.">            for (JField field : message.numericalOrderFields()) {</span>
<span class="fc" id="L398">                writer.newline();</span>

<span class="fc bfc" id="L400" title="All 2 branches covered.">                if (!field.alwaysPresent()) {</span>
<span class="fc" id="L401">                    writer.formatln(&quot;c = Boolean.compare(%s != null, other.%s != null);&quot;,</span>
<span class="fc" id="L402">                                    field.member(),</span>
<span class="fc" id="L403">                                    field.member())</span>
<span class="fc" id="L404">                          .appendln(&quot;if (c != 0) return c;&quot;)</span>
<span class="fc" id="L405">                          .formatln(&quot;if (%s != null) {&quot;, field.member())</span>
<span class="fc" id="L406">                          .begin();</span>
                }
<span class="pc bpc" id="L408" title="1 of 10 branches missed.">                switch (field.type()) {</span>
                    case BOOL:
<span class="fc" id="L410">                        writer.formatln(&quot;c = Boolean.compare(%s, other.%s);&quot;, field.member(), field.member());</span>
<span class="fc" id="L411">                        break;</span>
                    case BYTE:
<span class="fc" id="L413">                        writer.formatln(&quot;c = Byte.compare(%s, other.%s);&quot;, field.member(), field.member());</span>
<span class="fc" id="L414">                        break;</span>
                    case I16:
<span class="fc" id="L416">                        writer.formatln(&quot;c = Short.compare(%s, other.%s);&quot;, field.member(), field.member());</span>
<span class="fc" id="L417">                        break;</span>
                    case I32:
<span class="fc" id="L419">                        writer.formatln(&quot;c = Integer.compare(%s, other.%s);&quot;, field.member(), field.member());</span>
<span class="fc" id="L420">                        break;</span>
                    case I64:
<span class="fc" id="L422">                        writer.formatln(&quot;c = Long.compare(%s, other.%s);&quot;, field.member(), field.member());</span>
<span class="fc" id="L423">                        break;</span>
                    case DOUBLE:
<span class="fc" id="L425">                        writer.formatln(&quot;c = Double.compare(%s, other.%s);&quot;, field.member(), field.member());</span>
<span class="fc" id="L426">                        break;</span>
                    case STRING:
                    case BINARY:
                    case MESSAGE:
<span class="fc" id="L430">                        writer.formatln(&quot;c = %s.compareTo(other.%s);&quot;, field.member(), field.member());</span>
<span class="fc" id="L431">                        break;</span>
                    case ENUM:
<span class="fc" id="L433">                        writer.formatln(&quot;c = Integer.compare(%s.ordinal(), %s.ordinal());&quot;,</span>
<span class="fc" id="L434">                                        field.member(),</span>
<span class="fc" id="L435">                                        field.member());</span>
<span class="fc" id="L436">                        break;</span>
                    case SET:
                    case LIST:
                    case MAP:
<span class="fc" id="L440">                        writer.formatln(&quot;c = Integer.compare(%s.hashCode(), other.%s.hashCode());&quot;,</span>
<span class="fc" id="L441">                                        field.member(),</span>
<span class="fc" id="L442">                                        field.member());</span>
<span class="fc" id="L443">                        break;</span>
                    default:
                        break;
                }
<span class="fc" id="L447">                writer.appendln(&quot;if (c != 0) return c;&quot;);</span>

<span class="fc bfc" id="L449" title="All 2 branches covered.">                if (!field.alwaysPresent()) {</span>
<span class="fc" id="L450">                    writer.end()</span>
<span class="fc" id="L451">                          .appendln('}');</span>
                }
<span class="fc" id="L453">            }</span>
<span class="fc" id="L454">            writer.newline()</span>
<span class="fc" id="L455">                  .appendln(&quot;return 0;&quot;);</span>
        }

<span class="fc" id="L458">        writer.end()</span>
<span class="fc" id="L459">              .appendln(&quot;}&quot;)</span>
<span class="fc" id="L460">              .newline();</span>
<span class="fc" id="L461">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.9.201702052155</span></div></body></html>